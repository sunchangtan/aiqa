# 金融智能问答系统：元数据与数据源映射体系设计方案 (V2.0)

## 一、 建设背景与总体架构

本方案旨在构建一套**统一、可解释、可扩展**的金融语义体系，以支撑大模型（LLM）驱动的智能问答与查数能力。

针对传统“静态宽表映射”灵活性不足的问题，本方案采用 **“大模型智能体 (LLM Agent) + 语义工具层 (Semantic Tool Layer)”** 架构。核心在于构建一个**统一语义层**，将底层异构 API（数据库、搜索引擎、图谱）封装为 LLM 可理解的原子能力（Tools）。

### 1.1 核心分层架构

1. **意图路由层 (Intent Router)**
   - 负责识别用户意图（查数计算、关系推理、文档检索、混合查询）。
   - 负责规划执行路径（Planning），决定调用哪些工具。
2. **语义元数据层 (Semantic Layer)**
   - 定义实体、事件、关系及指标的标准语义，解决业务语言与技术实现的“认知对齐”问题。
3. **工具执行层 (Tool Execution)**
   - 将语义请求转化为具体的 API 调用、SQL 或 DSL。

---

## 二、 核心语义模型抽象 (Semantic Model)

为了支持复杂的金融逻辑推理，采用 **“实体-关系-事件”图谱化模型**，并将**文档**作为独立实体管理。

### 2.1 实体 (Entity)

现实世界的逻辑挂载点。

- **定义**：具有唯一标识符（ID）的客观主体。
- **核心类型**：
  - **主体类**：`Company` (企业), `Person` (自然人/高管), `Government` (监管机构/政府)
  - **标的类**：`Instrument` (证券标的，如股票、债券、基金)
  - **载体类**：`Document` (文档对象，详见 2.4)
- **关键元数据**：
  - `synonyms`: 同义词表（用于实体链接，如：万科 A <-> 000002.SZ <-> 万科集团）。

### 2.2 事件 (Event) —— [核心设计：节点化]

将事件视为图谱中的**节点 (Node)**，而非单纯依附于实体的属性字段。

- **定义**：在特定时间发生的独立事实。
- **核心类型**：`Default` (违约), `Lawsuit` (诉讼), `IPO` (上市), `RatingChange` (评级变更), `M&A` (并购)。
- **属性**：`event_id`, `event_date` (发生时间), `status` (状态), `amount` (涉及金额)。
- **设计优势**：支持多主体参与（例如：一场并购涉及买方、卖方、标的方，通过关系连接不同实体）。

### 2.3 关系 (Relation) —— [核心设计：双层关系]

关系是连接实体与实体、实体与事件的桥梁，必须具备方向性和时效性。

- **类型 A：结构性关系 (Structural Relation)**
  - **连接对象**：`Entity -> Entity`
  - **典型范例**：`SubsidiaryOf` (子公司), `SupplierOf` (供应商), `CompetitorOf` (竞争对手)。
  - **属性**：`weight` (如持股比例), `valid_period` (关系生效区间)。
- **类型 B：参与性关系 (Participatory Relation)**
  - **连接对象**：`Entity -> Event`
  - **核心属性**：**`Role` (角色)**
  - **典型范例**：
    - `Entity:恒大地产` --[`Role:Issuer`]--> `Event:债券违约`
    - `Entity:招商银行` --[`Role:Underwriter`]--> `Event:债券违约`
    - `Entity:公司A` --[`Role:Plaintiff`]--> `Event:合同纠纷诉讼`

### 2.4 文档 (Document) —— [核心设计：独立建模]

文档是信息的**载体**，事件是信息的**事实**。两者解耦。

- **定义**：非结构化数据的存储单元（公告、研报、新闻、法律文书）。
- **关键关系**：
  - `Proven_By` (Event -> Document)：事件由该文档证实/披露。
  - `Mentioned_In` (Entity -> Document)：实体在该文档中被提及。
- **应用场景**：解决“溯源”问题。用户问“根据什么说它违约了？”，系统通过 `Event -> Proven_By -> Document` 找到原始公告。

### 2.5 字段与指标 (Field & Metrics) —— [核心设计：指标中台化]

将属性分为静态与动态两类。

- **静态属性 (Attribute)**：值相对稳定。如 `Company.sector` (行业), `Bond.maturity_date` (到期日)。
- **动态指标 (Metric)**：必须依赖**维度 (Dimensions)** 才能确定的数值。
  - **范例**：`Revenue` (营收), `NetProfit` (净利润), `ClosePrice` (收盘价)。
  - **维度约束**：`Time` (报告期/日期), `Scope` (合并报表/母公司报表), `Unit` (币种)。
